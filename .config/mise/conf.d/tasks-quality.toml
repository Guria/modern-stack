[tasks.format]
description = "Format code with oxfmt"
alias = "fmt"
run = "oxfmt --write ."

[tasks."format:check"]
description = "Check code formatting"
alias = "fmt:check"
run = "oxfmt --check ."

[tasks.lint]
description = "Lint code with oxlint"
run = "oxlint ."

[tasks."lint:fix"]
description = "Lint code and apply fixes with oxlint"
run = "oxlint --fix ."

[tasks.typecheck]
description = "Type check with TypeScript"
alias = "tc"
run = "tsc -b"

[tasks."lint:circular"]
description = "Check for circular dependencies with madge"
run = "madge -c ./src/main.tsx --ts-config ./tsconfig.app.json --exclude styled-system"

[tasks."lint:steiger"]
description = "Check FSD architecture with steiger"
run = "bun scripts/steiger.ts"

[tasks."lint:paraglide-tree-shaking"]
description = "Verify unused translations are tree-shaken from the production bundle"
depends = ["build:webapp"]
run = "bun scripts/check-tree-shaking.ts"

[tasks.validate]
description = "Run all quality checks (format, lint, typecheck, test). Default validation task for LLMs"
run = [ #
	{ task = "prepare" },
	{ task = "format" },
	{ task = "lint:fix" },
	{ tasks = ["typecheck", "test:run", "lint:circular", "lint:steiger"] },
	{ task = "lint:paraglide-tree-shaking" },
]

[tasks.ci]
description = "Run all CI checks. No auto-fixes"
run = [
	{ tasks = [
		"prepare:panda",
		"prepare:paraglide",
	] },
	{ task = "format:check" },
	{ task = "lint" },
	{ tasks = [
		"typecheck",
		"lint:circular",
		"lint:steiger",
	] },
	{ task = "test:coverage" },
	{ task = "build" },
	{ task = "lint:paraglide-tree-shaking" },
]
